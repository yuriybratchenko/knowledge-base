<?php
/**
 *
 * Post Meta Template Functions.
 * Print HTML with a share buttons.
 *
 */

function kb_share_buttons( $args = array(), $config = array() ) {

	/**
	 * Default social networks.
	 *
	 * @since 1.0.0
	 *
	 * $1%s - `id`
	 * $2%s - `type`
	 * $3%s - `url`
	 * $4%s - `title`
	 * $5%s - `summary`
	 * $6%s - `thumbnail`
	 */

    $facebook_icon  = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24"/><path d="M8.63086 24V13.6H5V8.8H8.63086V5.45C8.63086 4.53333 8.76628 3.73333 9.03711 3.05C9.32487 2.36667 9.71419 1.8 10.2051 1.35C10.7129 0.9 11.3138 0.566667 12.0078 0.35C12.7018 0.116667 13.4635 0 14.293 0C15.0716 0 15.7741 0.025 16.4004 0.075C17.0267 0.108333 17.4329 0.141667 17.6191 0.175V3.975H15.334C14.4368 3.975 13.8444 4.16667 13.5566 4.55C13.2689 4.93333 13.125 5.43333 13.125 6.05V8.8H18L16.375 13.6H13.125V24H8.63086Z" fill="#62ACEB"/></svg>';
    $twitter_icon   = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M24 4.35577C23.5625 4.5641 23.1016 4.74038 22.6172 4.88462C22.1484 5.01282 21.6641 5.10897 21.1641 5.17308C21.6797 4.85256 22.125 4.45192 22.5 3.97115C22.875 3.49038 23.1562 2.95353 23.3438 2.36058C22.8594 2.64904 22.3516 2.89744 21.8203 3.10577C21.3047 3.3141 20.7656 3.47436 20.2031 3.58654C19.7656 3.10577 19.2344 2.72115 18.6094 2.43269C17.9844 2.14423 17.3203 2 16.6172 2C15.9297 2 15.2891 2.13622 14.6953 2.40865C14.1016 2.66506 13.5781 3.02564 13.125 3.49038C12.6875 3.9391 12.3359 4.46795 12.0703 5.07692C11.8203 5.6859 11.6953 6.34295 11.6953 7.04808C11.6953 7.24039 11.7031 7.43269 11.7188 7.625C11.75 7.81731 11.7812 8.00962 11.8125 8.20192C10.7969 8.15385 9.80469 7.99359 8.83594 7.72115C7.88281 7.44872 6.97656 7.08814 6.11719 6.63942C5.25781 6.17468 4.45312 5.62981 3.70312 5.00481C2.95312 4.37981 2.27344 3.68269 1.66406 2.91346C1.46094 3.29808 1.29688 3.70673 1.17188 4.13942C1.0625 4.55609 1.00781 4.99679 1.00781 5.46154C1.00781 6.34295 1.20312 7.15224 1.59375 7.88942C2 8.6266 2.53125 9.21955 3.1875 9.66827C2.78125 9.65224 2.39062 9.58814 2.01562 9.47596C1.64062 9.36378 1.28906 9.21955 0.960938 9.04327C0.960938 9.04327 0.960938 9.05128 0.960938 9.06731C0.960938 9.08333 0.960938 9.09135 0.960938 9.09135C0.960938 10.3253 1.33594 11.4071 2.08594 12.3365C2.85156 13.25 3.79688 13.8189 4.92188 14.0433C4.70312 14.1074 4.48438 14.1554 4.26562 14.1875C4.0625 14.2196 3.84375 14.2356 3.60938 14.2356C3.45312 14.2356 3.29688 14.2276 3.14062 14.2115C2.98438 14.1955 2.83594 14.1715 2.69531 14.1394C3.00781 15.133 3.57812 15.9583 4.40625 16.6154C5.25 17.2724 6.21094 17.617 7.28906 17.649C6.44531 18.3221 5.5 18.851 4.45312 19.2356C3.42188 19.6202 2.32812 19.8125 1.17188 19.8125C0.96875 19.8125 0.765625 19.8045 0.5625 19.7885C0.375 19.7724 0.1875 19.7564 0 19.7404C0.546875 20.0929 1.11719 20.4135 1.71094 20.7019C2.30469 20.9744 2.91406 21.2067 3.53906 21.399C4.17969 21.5913 4.83594 21.7436 5.50781 21.8558C6.17969 21.9519 6.85938 22 7.54688 22C9.8125 22 11.8125 21.5673 13.5469 20.7019C15.2969 19.8205 16.7656 18.6907 17.9531 17.3125C19.1406 15.9343 20.0391 14.3958 20.6484 12.6971C21.2578 10.9824 21.5625 9.29167 21.5625 7.625C21.5625 7.52885 21.5547 7.42468 21.5391 7.3125C21.5391 7.20032 21.5391 7.08814 21.5391 6.97596C22.0234 6.6234 22.4688 6.23077 22.875 5.79808C23.2969 5.34936 23.6719 4.86859 24 4.35577Z" fill="#4FD5CE"/></svg>';
    $linkedin_icon  = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13.3031 9.96866C13.3031 9.40185 13.2935 8.83471 13.3074 8.26824C13.3137 8.01008 13.2312 7.9131 12.9641 7.91502C11.5747 7.92501 10.1852 7.92444 8.79565 7.91525C8.54101 7.91355 8.44587 7.98308 8.44633 8.25554C8.45345 13.3884 8.45334 18.5213 8.44655 23.6542C8.4461 23.9209 8.53106 24.001 8.79124 23.9993C10.2447 23.9897 11.6982 23.989 13.1516 23.9998C13.416 24.0019 13.4902 23.92 13.4892 23.656C13.4797 21.218 13.4766 18.7797 13.4886 16.3417C13.4916 15.7396 13.5284 15.1346 13.5996 14.5368C13.6772 13.8842 13.8856 13.2673 14.3429 12.7696C14.9301 12.1306 15.6927 11.9866 16.5162 12.002C17.6654 12.0235 18.3816 12.5604 18.7099 13.6635C18.9215 14.3744 18.9385 15.1053 18.9388 15.8378C18.9402 18.4317 18.9391 21.0257 18.9399 23.6196C18.94 23.982 18.9516 23.9941 19.307 23.9943C20.7238 23.9954 22.1407 23.995 23.5576 23.9946C23.9994 23.9946 24.0016 23.9939 23.9998 23.5574C23.9869 20.4146 23.9787 17.2717 23.9561 14.1289C23.9492 13.1661 23.8204 12.2141 23.5575 11.286C23.1549 9.8651 22.3965 8.70619 21.0036 8.10093C19.5462 7.46766 18.0199 7.3531 16.4769 7.73263C15.1452 8.06023 14.0926 8.80965 13.3031 9.96866ZM5.41968 15.972C5.41968 13.4058 5.41515 10.8397 5.42624 8.27357C5.42737 7.99511 5.35328 7.91174 5.07567 7.91401C3.63164 7.92592 2.18738 7.92512 0.743342 7.91457C0.472748 7.91253 0.38157 7.98853 0.381909 8.27142C0.389715 13.3946 0.389715 18.5176 0.382022 23.6407C0.38157 23.921 0.467543 24.002 0.741192 23.9998C2.18523 23.9888 3.62937 23.9887 5.07352 24C5.34728 24.0021 5.42771 23.9251 5.42647 23.6429C5.41493 21.086 5.41968 18.5289 5.41968 15.972ZM0 2.9221C0.000339373 4.52213 1.30715 5.86196 2.90538 5.84596C4.55439 5.8294 5.83406 4.58395 5.831 2.91881C5.82795 1.22463 4.52532 -0.00936111 2.90232 5.35054e-05C1.17152 0.0101487 0.00305436 1.39909 0 2.9221Z" fill="#37D7A5"/></svg>';
    $pinterest_icon = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M24 12C24 5.37097 18.629 0 12 0C5.37097 0 0 5.37097 0 12C0 17.129 3.14516 21.4355 7.59677 23.1774C7.5 22.2581 7.40323 20.8065 7.64516 19.7419C7.8871 18.8226 9.04839 13.7903 9.04839 13.7903C9.04839 13.7903 8.70968 13.0645 8.70968 12C8.70968 10.3548 9.67742 9.09677 10.8871 9.09677C11.9032 9.09677 12.3871 9.87097 12.3871 10.7903C12.3871 11.8065 11.7097 13.3548 11.371 14.8065C11.129 15.9677 12 16.9355 13.1613 16.9355C15.2903 16.9355 16.9355 14.7097 16.9355 11.4677C16.9355 8.56452 14.8548 6.58065 11.9516 6.58065C8.51613 6.58065 6.53226 9.14516 6.53226 11.7581C6.53226 12.8226 6.91935 13.9355 7.40323 14.5161C7.5 14.6129 7.5 14.7581 7.5 14.8548C7.40323 15.2419 7.16129 16.0645 7.16129 16.2097C7.1129 16.4516 6.96774 16.5 6.72581 16.4032C5.22581 15.6774 4.30645 13.5 4.30645 11.7097C4.30645 7.93548 7.06452 4.45161 12.2419 4.45161C16.4032 4.45161 19.6452 7.45161 19.6452 11.4194C19.6452 15.5323 17.0323 18.871 13.4032 18.871C12.1935 18.871 11.0323 18.2419 10.6452 17.4677C10.6452 17.4677 10.0645 19.7903 9.91935 20.3226C9.62903 21.3871 8.90323 22.6935 8.41935 23.4677C9.53226 23.8548 10.7419 24 12 24C18.629 24 24 18.629 24 12Z" fill="#2ACD97"/></svg>';

    $defaults = apply_filters( 'kb_default_args_share_buttons', array(

		'facebook' => array(
			'icon'      => $facebook_icon,
			'name'      => esc_html__( 'Facebook', 'knowledge-base' ),
			'share_url' => 'https://www.facebook.com/sharer/sharer.php?u=%3$s&t=%4$s',
		),
		'twitter' => array(
			'icon'      => $twitter_icon,
			'name'      => esc_html__( 'Twitter', 'knowledge-base' ),
			'share_url' => 'https://twitter.com/intent/tweet?url=%3$s&text=%4$s',
		),
		'linkedin' => array(
			'icon'      => $linkedin_icon,
			'name'      => esc_html__( 'LinkedIn', 'knowledge-base' ),
			'share_url' => 'https://www.linkedin.com/shareArticle?mini=true&url=%3$s&title=%4$s&summary=%5$s&source=%3$s',
		),
		'pinterest' => array(
			'name'      => esc_html__( 'Pinterest', 'knowledge-base' ),
			'icon'      => $pinterest_icon,
			'share_url' => 'https://www.pinterest.com/pin/create/button/?url=%3$s&description=%4$s&media=%6$s',
		),

	) );

	$networks = wp_parse_args( $args, $defaults );

	$default_config = apply_filters( 'kb_default_config_share_buttons', array(
		'http'         => is_ssl() ? 'https' : 'http',
		'custom_class' => '',
	) );

	$config = wp_parse_args( $config, $default_config );

	// Prepare a data for sharing.
	$id           = get_the_ID();
	$type         = get_post_type( $id );
	$url          = get_permalink( $id );
	$title        = get_the_title( $id );
	$summary      = get_the_excerpt();
	$thumbnail_id = get_post_thumbnail_id( $id );
	$thumbnail    = '';

	if ( ! empty( $thumbnail_id ) ) {
		$thumbnail = wp_get_attachment_image_src( $thumbnail_id, 'full' );
		$thumbnail = $thumbnail[0];
	}

    $share_item_html = apply_filters( 'kb_share_button_html',
		'<div class="d-inline-flex mb-8 mr-12"><a class="share__item-link %2$s" href="%1$s" rel="nofollow" title="%3$s">%4$s</a></div>'
	);
	$share_buttons = '';

	foreach ( (array) $networks as $id => $network ) :

		if ( empty( $network['share_url'] ) ) {
			continue;
		}

		$share_url = sprintf( $network['share_url'],
			urlencode( $id ),
			urlencode( $type ),
			urlencode( $url ),
			urlencode( $title ),
			urlencode( $summary ),
			urlencode( $thumbnail )
		);

		$share_buttons .= sprintf(
			$share_item_html,
			htmlentities( $share_url ),
			sanitize_html_class( $id ),
			esc_html__( 'Share on ', 'knowledge-base' ) . $network['name'],
            $network['icon'],
			esc_attr( $network['name'] )
		);

	endforeach;

    echo '<div class="d-inline-flex flex-column sticky-top kb-share">';
	    echo $share_buttons;
    echo '</div>';

}